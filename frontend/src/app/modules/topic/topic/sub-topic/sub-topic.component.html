<div class="container-fluid mt-3">

  <mat-card *ngIf="subTopic" class="mb-3">
    <div>
      <span class="text-primary" style="font-size: 30px">{{subTopic.name}}</span>
      <span class="float-right">
        <button mat-button color="accent">
          Follow
        </button>
      </span>
    </div>
    <div>
      {{subTopic.description}}
    </div>
    <div class="mt-2">
      <span class="mr-2">Mods:</span>
      <span *ngFor="let mod of moderators">
        <a [matTooltip]="mod.name" matTooltipPosition="above"
           [routerLink]="['/']" class="mr-1" style="text-decoration: none">
          <img [src]="mod.avatar" [alt]="mod.name" class="img-fluid"
               style="width:40px; height: 40px">
        </a>
      </span>
    </div>
  </mat-card>

  <div class="shadow-2">
    <app-thread-search-input (searchOut)="onSearchOut($event)"></app-thread-search-input>

    <mat-table #table [dataSource]="dataSource" matSort matSortStart="desc" [matSortDisableClear]="true">

      <ng-container matColumnDef="title">
        <mat-header-cell *matHeaderCellDef mat-sort-header start="asc">Title</mat-header-cell>
        <mat-cell *matCellDef="let row" [title]="row.title">
          <a [matTooltip]="row.createdBy.name" matTooltipPosition="above"
             [routerLink]="['/']" class="mr-1" style="text-decoration: none">
            <img [src]="row.createdBy.avatar" [alt]="row.createdBy.name" class="img-fluid"
                 style="width:30px; height: 30px">
          </a>
          <span *ngIf="row.pinned" class="badge badge-primary badge-line-fix mr-1">
            <i class="fa fa-thumb-tack"></i>
            Pinned
          </span>
          <app-badge-role [user]="row.createdBy"></app-badge-role>
          <app-badge-approval-status [status]="row.approvalStatus"></app-badge-approval-status>
          <span [class.font-weight-bold]="row.highlight">{{row.title | shorten: 100:'...'}}</span>

          <ng-container *ngIf="authenticated">
            <button mat-icon-button clickStopPropagation [matMenuTriggerFor]="menu" class="menu d-none">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #menu="matMenu">
              <ng-container *ngIf="currentUser.role === role.Administrator || management">
                <ng-container *ngIf="row.approvalStatus == approvalStatus.Pending">
                  <button mat-menu-item>
                    Approve
                  </button>
                  <button mat-menu-item>
                    Decline
                  </button>
                  <div class="divider"></div>
                </ng-container>
                <button mat-menu-item>
                  Delete
                </button>
                <div class="divider"></div>
              </ng-container>
              <ng-container *ngIf="currentUser.role === role.Administrator">
                <button mat-menu-item *ngIf="!row.pinned">
                  Pin
                </button>
                <button mat-menu-item *ngIf="row.pinned">
                  Unpin
                </button>
                <div class="divider"></div>
              </ng-container>
              <button mat-menu-item>
                Report
              </button>
            </mat-menu>
          </ng-container>

        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="numberOfPosts">
        <mat-header-cell *matHeaderCellDef mat-sort-header>Posts</mat-header-cell>
        <mat-cell *matCellDef="let row">
          {{row.numberOfPosts}}
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="views">
        <mat-header-cell *matHeaderCellDef mat-sort-header>Views</mat-header-cell>
        <mat-cell *matCellDef="let row">
          {{row.views}}
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="lastActivity">
        <mat-header-cell *matHeaderCellDef mat-sort-header>Activity</mat-header-cell>
        <mat-cell *matCellDef="let row">
          {{row.lastActivity | amTimeAgo}}
        </mat-cell>
      </ng-container>

      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayedColumns;"
               [routerLink]="['/thread', row.id]"
               [class.pinned]="row.pinned"></mat-row>

    </mat-table>

    <mat-card *ngIf="!behavior.value.length && !loading">
      <mat-card-content class="justify-content-center d-flex py-5">
        We couldn't find any thread.
      </mat-card-content>
    </mat-card>

    <mat-paginator #paginator
                   [hidden]="!behavior.value.length && !loading"
                   [length]="behavior.value.length"
                   [pageIndex]="0"
                   [pageSizeOptions]="[20, 25, 30]">
    </mat-paginator>
  </div>

</div>
